{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>{% block title %}Morning Star Academy{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'images/favicon.svg' %}">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="{% static 'images/favicon-16x16.svg' %}">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="{% static 'images/favicon.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'images/favicon.svg' %}">
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Morning Star Academy">
    <meta name="msapplication-TileColor" content="#1e40af">
    <meta name="msapplication-TileImage" content="{% static 'images/favicon.svg' %}">
    <link rel="manifest" href="{% static 'manifest.json' %}">

    {% tailwind_css %}
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{% static 'css/images.css' %}" rel="stylesheet">
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Main Content -->
    <main>
        {% block content %}
        {% endblock %}
    </main>

    <!-- Footer -->
    {% include 'components/footer.html' %}

    <!-- Loading Component -->
    {% include 'components/loading.html' %}

    <!-- Mobile Optimizations -->
    <style>
        /* Improve touch targets for mobile */
        @media (max-width: 768px) {

            .btn-primary,
            .btn-secondary,
            button,
            input[type="submit"] {
                min-height: 44px;
                min-width: 44px;
            }

            /* Improve form input touch targets */
            input,
            select,
            textarea {
                min-height: 44px;
            }

            /* Prevent zoom on input focus for iOS */
            input,
            select,
            textarea {
                font-size: 16px;
            }

            /* Smooth scrolling */
            html {
                scroll-behavior: smooth;
            }

            /* Improve tap highlighting */
            a,
            button {
                -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1);
            }
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Focus improvements for accessibility */
        .form-input:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
    </style>

    <!-- Mobile Menu JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileMenuButton = document.querySelector('.mobile-menu-button');
            const mobileMenu = document.querySelector('.mobile-menu');
            const hamburgerIcon = document.querySelector('.hamburger-icon');
            const closeIcon = document.querySelector('.close-icon');

            if (mobileMenuButton && mobileMenu) {
                // Handle menu toggle
                function toggleMenu() {
                    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';

                    // Toggle menu visibility
                    mobileMenu.classList.toggle('hidden');

                    // Toggle icons
                    hamburgerIcon.classList.toggle('hidden');
                    closeIcon.classList.toggle('hidden');

                    // Update aria-expanded
                    mobileMenuButton.setAttribute('aria-expanded', !isExpanded);

                    // Prevent body scroll when menu is open
                    if (!isExpanded) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                }

                // Close menu function
                function closeMenu() {
                    mobileMenu.classList.add('hidden');
                    hamburgerIcon.classList.remove('hidden');
                    closeIcon.classList.add('hidden');
                    mobileMenuButton.setAttribute('aria-expanded', 'false');
                    document.body.style.overflow = '';
                }

                // Toggle menu on button click
                mobileMenuButton.addEventListener('click', toggleMenu);

                // Close mobile menu when clicking on a link
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', closeMenu);
                });

                // Close menu when clicking outside
                document.addEventListener('click', function (event) {
                    if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target)) {
                        if (!mobileMenu.classList.contains('hidden')) {
                            closeMenu();
                        }
                    }
                });

                // Close menu on escape key
                document.addEventListener('keydown', function (event) {
                    if (event.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
                        closeMenu();
                    }
                });

                // Handle window resize
                window.addEventListener('resize', function () {
                    if (window.innerWidth >= 768) { // md breakpoint
                        closeMenu();
                    }
                });
            }

            // Form loading states
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function () {
                    const submitButton = form.querySelector('button[type="submit"], input[type="submit"]');
                    if (submitButton) {
                        submitButton.classList.add('loading');
                        submitButton.disabled = true;

                        // Re-enable after 5 seconds as fallback
                        setTimeout(() => {
                            submitButton.classList.remove('loading');
                            submitButton.disabled = false;
                        }, 5000);
                    }
                });
            });

            // Smooth scroll for anchor links
            const anchorLinks = document.querySelectorAll('a[href^="#"]');
            anchorLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        e.preventDefault();
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Form enhancements
            const formInputs = document.querySelectorAll('.form-input, .form-textarea, .form-select');

            // Add focus/blur animations
            formInputs.forEach(input => {
                input.addEventListener('focus', function () {
                    this.parentElement.classList.add('focused');
                });

                input.addEventListener('blur', function () {
                    this.parentElement.classList.remove('focused');

                    // Add validation styling
                    if (this.checkValidity()) {
                        this.classList.remove('error');
                        this.classList.add('valid');
                    } else if (this.value) {
                        this.classList.add('error');
                        this.classList.remove('valid');
                    }
                });
            });

            // Phone number formatting
            const phoneInputs = document.querySelectorAll('input[type="tel"]');
            phoneInputs.forEach(input => {
                input.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.startsWith('233')) {
                        value = '+' + value;
                    } else if (value.startsWith('0')) {
                        value = '+233' + value.substring(1);
                    }
                    e.target.value = value;
                });
            });

            // Auto-resize textareas
            const textareas = document.querySelectorAll('.form-textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function () {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });
            });

            // Form section animations on scroll
            const formSections = document.querySelectorAll('.form-section');
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            formSections.forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(section);
            });
        });
    </script>
    {% block extra_js %}
    {% endblock %}
</body>

</html>